🏗️ ARQUITETURA DE CONEXÃO - TRACKMAX DASHBOARD

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              FRONTEND LAYER                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐            │
│  │   Firebase      │    │    Netlify      │    │   Localhost     │            │
│  │   Hosting       │    │   (Backup)      │    │   (Dev)         │            │
│  │                 │    │                 │    │                 │            │
│  │ dashboard-      │    │ dashboard-      │    │ localhost:5173  │            │
│  │ trackmax-web    │    │ trackmax        │    │ localhost:3003  │            │
│  │ .web.app        │    │ .netlify.app    │    │ localhost:4173  │            │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘            │
│           │                       │                       │                   │
│           │                       │                       │                   │
│           ▼                       ▼                       ▼                   │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                    REACT APPLICATION                                   │   │
│  │  • src/config/api.ts - API URL Configuration                          │   │
│  │  • src/providers/auth.ts - Authentication                             │   │
│  │  • src/hooks/useTrackmaxApi.ts - API Calls                            │   │
│  │  • Basic Auth with localStorage                                       │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              PROXY LAYER                                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────┐    ┌─────────────────────────────────┐    │
│  │      Cloudflare Worker          │    │      Netlify Functions          │    │
│  │         (PRIMARY)               │    │        (BACKUP)                 │    │
│  │                                 │    │                                 │    │
│  │ trackmax-proxy.trackmax-        │    │ dashboard-trackmax.netlify.     │    │
│  │ proxy.workers.dev/api           │    │ app/api                         │    │
│  │                                 │    │                                 │    │
│  │ ✅ CORS Configured              │    │ ⚠️ CORS Issues (Fixed)          │    │
│  │ ✅ Rate Limiting                │    │ ✅ Rate Limiting                │    │
│  │ ✅ Basic Auth Forward           │    │ ✅ Basic Auth Forward           │    │
│  └─────────────────────────────────┘    └─────────────────────────────────┘    │
│                    │                                       │                   │
│                    │                                       │                   │
│                    ▼                                       ▼                   │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        PROXY FUNCTIONS                                │   │
│  │  • CORS Headers Management                                            │   │
│  │  • Request/Response Forwarding                                        │   │
│  │  • Authentication Header Injection                                    │   │
│  │  • Rate Limiting & Throttling                                         │   │
│  │  • Error Handling & Retry Logic                                       │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            TRACCAR SERVER                                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                    TRACCAR API SERVER                                 │   │
│  │                                                                       │   │
│  │  URL: http://35.230.168.225:8082/api                                 │   │
│  │                                                                       │   │
│  │  🔐 Authentication: Basic Auth                                        │   │
│  │  📡 Endpoints:                                                        │   │
│  │     • /api/server - Server Info                                       │   │
│  │     • /api/devices - Device List                                      │   │
│  │     • /api/positions - Vehicle Positions                              │   │
│  │     • /api/reports/events - System Events                             │   │
│  │     • /api/reports/trips - Trip Reports                               │   │
│  │                                                                       │   │
│  │  🚗 Data: 2000+ Devices                                               │   │
│  │  📊 Real-time: GPS Tracking                                           │   │
│  │  ⚡ Performance: Optimized for Large Fleets                           │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘

🔄 FLUXO DE DADOS:

1. Frontend Request → API URL Resolution (getApiUrlSync)
2. Environment Detection → Localhost vs Production
3. Proxy Selection → Cloudflare Worker (Primary) or Netlify (Backup)
4. CORS Headers → Applied by Proxy
5. Authentication → Basic Auth Headers Added
6. Request Forward → To Traccar Server
7. Response Processing → JSON Data Returned
8. Frontend Update → React State Management

🔧 CONFIGURAÇÃO ATUAL:

✅ PRODUCTION (Firebase + Cloudflare):
   Frontend: https://dashboard-trackmax-web.web.app
   Proxy: https://trackmax-proxy.trackmax-proxy.workers.dev/api
   Backend: http://35.230.168.225:8082/api

✅ DEVELOPMENT (Localhost):
   Frontend: http://localhost:5173
   Proxy: Direct Connection
   Backend: http://35.230.168.225:8082/api

⚠️ BACKUP (Netlify):
   Frontend: https://dashboard-trackmax.netlify.app
   Proxy: https://dashboard-trackmax.netlify.app/api
   Backend: http://35.230.168.225:8082/api

🎯 STATUS: ✅ SISTEMA FUNCIONANDO EM PRODUÇÃO



