<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Credenciais TrackMax</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        input { padding: 8px; margin: 5px; width: 200px; }
        .credentials { display: flex; gap: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Teste de Credenciais TrackMax</h1>
    
    <div class="test">
        <h3>Teste Manual</h3>
        <div class="credentials">
            <input type="text" id="username" placeholder="Usuário" value="admin">
            <input type="password" id="password" placeholder="Senha" value="admin">
            <button onclick="testCredentials()">Testar Credenciais</button>
        </div>
        <div id="result"></div>
    </div>
    
    <div class="test">
        <h3>Credenciais Comuns do Traccar</h3>
        <button onclick="testCommonCredentials()">Testar Credenciais Comuns</button>
        <div id="commonResult"></div>
    </div>

    <script>
        const CLOUDFLARE_WORKER_URL = 'https://trackmax-proxy.trackmax-proxy.workers.dev/api';
        
        async function testCredentials() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('result');
            
            if (!username || !password) {
                resultDiv.innerHTML = '<div class="error">❌ Por favor, preencha usuário e senha</div>';
                return;
            }
            
            resultDiv.innerHTML = 'Testando...';
            
            try {
                const credentials = btoa(`${username}:${password}`);
                
                // Testar /api/server
                const serverResponse = await fetch(`${CLOUDFLARE_WORKER_URL}/server`, {
                    headers: { 'Authorization': `Basic ${credentials}` }
                });
                
                // Testar /api/devices
                const devicesResponse = await fetch(`${CLOUDFLARE_WORKER_URL}/devices?limit=1`, {
                    headers: { 'Authorization': `Basic ${credentials}` }
                });
                
                let result = `<div class="test">
                    <h4>Resultado para ${username}:${password}</h4>
                    <p><strong>/api/server:</strong> ${serverResponse.ok ? '✅ OK' : '❌ ' + serverResponse.status}</p>
                    <p><strong>/api/devices:</strong> ${devicesResponse.ok ? '✅ OK' : '❌ ' + devicesResponse.status}</p>
                </div>`;
                
                if (serverResponse.ok && devicesResponse.ok) {
                    result = `<div class="success">✅ Credenciais completas! Usuário pode acessar todos os endpoints.</div>` + result;
                } else if (serverResponse.ok && !devicesResponse.ok) {
                    result = `<div class="warning">⚠️ Credenciais parciais! Usuário pode acessar /server mas não /devices.</div>` + result;
                } else {
                    result = `<div class="error">❌ Credenciais inválidas!</div>` + result;
                }
                
                resultDiv.innerHTML = result;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">❌ Erro: ${error.message}</div>`;
            }
        }
        
        async function testCommonCredentials() {
            const resultDiv = document.getElementById('commonResult');
            resultDiv.innerHTML = 'Testando credenciais comuns...';
            
            const credentials = [
                { user: 'admin', pass: 'admin', name: 'Admin Padrão' },
                { user: 'admin', pass: 'password', name: 'Admin Password' },
                { user: 'admin', pass: '123456', name: 'Admin 123456' },
                { user: 'admin', pass: 'trackmax', name: 'Admin TrackMax' },
                { user: 'trackmax', pass: 'trackmax', name: 'TrackMax' },
                { user: 'trackmax', pass: 'admin', name: 'TrackMax Admin' },
                { user: 'ndev', pass: '2025', name: 'NDEV' },
                { user: 'user', pass: 'user', name: 'User Padrão' },
                { user: 'test', pass: 'test', name: 'Test' }
            ];
            
            let results = '';
            
            for (const cred of credentials) {
                try {
                    const encoded = btoa(`${cred.user}:${cred.pass}`);
                    
                    const serverResponse = await fetch(`${CLOUDFLARE_WORKER_URL}/server`, {
                        headers: { 'Authorization': `Basic ${encoded}` }
                    });
                    
                    const devicesResponse = await fetch(`${CLOUDFLARE_WORKER_URL}/devices?limit=1`, {
                        headers: { 'Authorization': `Basic ${encoded}` }
                    });
                    
                    const serverOk = serverResponse.ok;
                    const devicesOk = devicesResponse.ok;
                    
                    let status = '';
                    let className = 'test';
                    if (serverOk && devicesOk) {
                        status = '<span style="color: green;">✅ COMPLETO</span>';
                        className = 'success';
                    } else if (serverOk && !devicesOk) {
                        status = '<span style="color: orange;">⚠️ PARCIAL</span>';
                        className = 'warning';
                    } else {
                        status = '<span style="color: red;">❌ INVÁLIDO</span>';
                        className = 'error';
                    }
                    
                    results += `<div class="${className}">
                        <h4>${cred.name} (${cred.user}:${cred.pass})</h4>
                        <p>Status: ${status}</p>
                        <p>/api/server: ${serverOk ? '✅' : '❌'}</p>
                        <p>/api/devices: ${devicesOk ? '✅' : '❌'}</p>
                    </div>`;
                    
                } catch (error) {
                    results += `<div class="error">❌ Erro testando ${cred.name}: ${error.message}</div>`;
                }
            }
            
            resultDiv.innerHTML = results;
        }
    </script>
</body>
</html>



